"use strict";(self.webpackChunkstarlake=self.webpackChunkstarlake||[]).push([[211],{19500:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>o});var a=s(74848),n=s(28453);const r={},i="Test Load Tasks",d={id:"guides/unit-tests/load-tests",title:"Test Load Tasks",description:"Test your load task locally before deploying to production.",source:"@site/versioned_docs/version-1.2.0/0300-guides/0400-unit-tests/100-load-tests.mdx",sourceDirName:"0300-guides/0400-unit-tests",slug:"/guides/unit-tests/load-tests",permalink:"/starlake/docs/guides/unit-tests/load-tests",draft:!1,unlisted:!1,editUrl:"https://github.com/starlake-ai/starlake/edit/master/docs/versioned_docs/version-1.2.0/0300-guides/0400-unit-tests/100-load-tests.mdx",tags:[],version:"1.2.0",sidebarPosition:100,frontMatter:{},sidebar:"starlakeSidebar",previous:{title:"Unit tests in Data Engineering",permalink:"/starlake/docs/guides/unit-tests/concepts"},next:{title:"Test Transform Tasks",permalink:"/starlake/docs/guides/unit-tests/transform-tests"}},l={},o=[{value:"Example: Load  summary report",id:"example-load--summary-report",level:2},{value:"Example: Transform Test report",id:"example-transform-test-report",level:2},{value:"Example: Load &amp; Transform report",id:"example-load--transform-report",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"test-load-tasks",children:"Test Load Tasks"}),"\n",(0,a.jsx)(t.p,{children:"Test your load task locally before deploying to production."}),"\n",(0,a.jsx)(t.p,{children:"Load tasks are the first step in the data pipeline.\nThey are responsible for loading data from the source to the destination.\nIn this tutorial, we will test the load tasks."}),"\n",(0,a.jsxs)(t.p,{children:["Load tests are located in the ",(0,a.jsx)(t.code,{children:"metadata/tests/load"})," directory."]}),"\n",(0,a.jsxs)(t.p,{children:["Each test is a directory located in the ",(0,a.jsx)(t.code,{children:"domain/table"})," subdirectory and contains the following files:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["a CSV or JSONL file that will contain the initial data that will be loaded into the table before the unit test is run.\nThis file should be named after the domain and table names. For example, the file for the ",(0,a.jsx)(t.code,{children:"starbake.product"})," table should be named ",(0,a.jsx)(t.code,{children:"starbake.product.json"})," or ",(0,a.jsx)(t.code,{children:"starbake.product.csv"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["one or multiple data files whose names match the file pattern expected by the loader for this table. This is the data that will be loaded into the table using the ",(0,a.jsx)(t.code,{children:"starlake load"})," task."]}),"\n",(0,a.jsxs)(t.li,{children:["a ",(0,a.jsx)(t.code,{children:"_expected.csv"})," file that contains the expected data in the table after the load task is run."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["After loading using the ",(0,a.jsx)(t.code,{children:"starlake load"})," task against the schema defined in the ",(0,a.jsx)(t.code,{children:"metadata/load"})," directory,\nStarlake will compare the schema of the table with the schema of the expected data file and will raise an error if they do not match."]}),"\n",(0,a.jsxs)(t.p,{children:["The test will pass if the load task succeeds and the data in the table matches the data in the ",(0,a.jsx)(t.code,{children:"_expected.csv"})," file."]}),"\n",(0,a.jsxs)(t.p,{children:["The reports of the test ",(0,a.jsx)(t.code,{children:"test-name"})," are stored in the ",(0,a.jsx)(t.code,{children:"test-reports/load/test-name"})," directory and contain the following files:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"test-reports/load/test-name/testname.db"}),": the actual database after the load task is run. This database contains the following tables:","\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"sl_expected: The expected data."}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"starbake.product"}),": The actual data."]}),"\n",(0,a.jsx)(t.li,{children:"sl_expectations: The results of the execution of any the expectation related to this table."}),"\n",(0,a.jsx)(t.li,{children:"audit.audit: The audit log of the load task."}),"\n",(0,a.jsx)(t.li,{children:"audit.rejected: The rejected data."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"test-reports/load/test-name/not_expected.csv"}),": the unexpected data in the actual table after the load task is run."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"test-reports/load/test-name/missing.csv"}),": the missing data in the actual table after the load task is run."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["The test reports are generated using the ",(0,a.jsx)(t.code,{children:"starlake test"})," task."]}),"\n",(0,a.jsx)(t.p,{children:"To run the load tests without running transform tests, use the following command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"starlake test --load\n"})}),"\n",(0,a.jsxs)(t.p,{children:["To run a specific test use the ",(0,a.jsx)(t.code,{children:"--name"})," flag:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"starlake test --name starbake.product.test-name\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Running tests will also generate a complete website report in the ",(0,a.jsx)(t.code,{children:"test-reports"})," directory."]}),"\n",(0,a.jsx)(t.h2,{id:"example-load--summary-report",children:"Example: Load  summary report"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:s(19367).A+"",width:"768",height:"377"})}),"\n",(0,a.jsx)(t.h2,{id:"example-transform-test-report",children:"Example: Transform Test report"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:s(5402).A+"",width:"783",height:"576"})}),"\n",(0,a.jsx)(t.h2,{id:"example-load--transform-report",children:"Example: Load & Transform report"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:s(92082).A+"",width:"768",height:"425"})})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},19367:(e,t,s)=>{s.d(t,{A:()=>a});const a=s.p+"assets/images/load-summary-e46b35d6c4082a8664bbb20ceb83ace0.png"},92082:(e,t,s)=>{s.d(t,{A:()=>a});const a=s.p+"assets/images/report-f0a008ed2359a2a4af3738eb28b19b53.png"},5402:(e,t,s)=>{s.d(t,{A:()=>a});const a=s.p+"assets/images/transform-98e87387c51455f62f0d6a35e1d05cab.png"},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>d});var a=s(96540);const n={},r=a.createContext(n);function i(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);