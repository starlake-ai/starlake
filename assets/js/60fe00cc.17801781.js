"use strict";(self.webpackChunkstarlake=self.webpackChunkstarlake||[]).push([[1628],{85977:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>n,metadata:()=>o,toc:()=>d});var r=s(74848),a=s(28453);const n={},i="Test Transform Tasks",o={id:"guides/unit-tests/transform-tests",title:"Test Transform Tasks",description:"Test your transform locally before deploying to production.",source:"@site/versioned_docs/version-1.2.0/0300-guides/0400-unit-tests/200-transform-tests.mdx",sourceDirName:"0300-guides/0400-unit-tests",slug:"/guides/unit-tests/transform-tests",permalink:"/starlake/docs/guides/unit-tests/transform-tests",draft:!1,unlisted:!1,editUrl:"https://github.com/starlake-ai/starlake/edit/master/docs/versioned_docs/version-1.2.0/0300-guides/0400-unit-tests/200-transform-tests.mdx",tags:[],version:"1.2.0",sidebarPosition:200,frontMatter:{},sidebar:"starlakeSidebar",previous:{title:"Test Load Tasks",permalink:"/starlake/docs/guides/unit-tests/load-tests"},next:{title:"Orchestrate",permalink:"/starlake/docs/category/orchestrate"}},l={},d=[{value:"Example: Load  summary report",id:"example-load--summary-report",level:2},{value:"Example: Transform Test report",id:"example-transform-test-report",level:2},{value:"Example: Load &amp; Transform report",id:"example-load--transform-report",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"test-transform-tasks",children:"Test Transform Tasks"}),"\n",(0,r.jsx)(t.p,{children:"Test your transform locally before deploying to production."}),"\n",(0,r.jsx)(t.p,{children:"Transform tasks are the second step in the data pipeline.\nThey are responsible for transforming the data in the database.\nIn this tutorial, we will test the transform tasks."}),"\n",(0,r.jsxs)(t.p,{children:["Transform tests are located in the ",(0,r.jsx)(t.code,{children:"metadata/tests/transform"})," directory."]}),"\n",(0,r.jsxs)(t.p,{children:["Each test is a directory located in the ",(0,r.jsx)(t.code,{children:"domain/table"})," subdirectory and contains the following files:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["multiple CSV or JSONL files that will contain the initial data that will be loaded into the tables before the unit test is run.\nThese files should be named after the domain and table names. For example, the file for the ",(0,r.jsx)(t.code,{children:"starbake.product"})," table should be named ",(0,r.jsx)(t.code,{children:"starbake.product.json"})," or ",(0,r.jsx)(t.code,{children:"starbake.product.csv"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["a ",(0,r.jsx)(t.code,{children:"_expected.csv"})," or ",(0,r.jsx)(t.code,{children:"_expected.sql"})," file that contains the expected data in the table after the transform task is run."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Before running the transform, starlake will transpile your SQL statements to the Duckdb dialect before running it.\nAfter running the transpiled SQL staement using the ",(0,r.jsx)(t.code,{children:"starlake transform"})," task against local duckdb database populated by starlake using the data files present in the test directory,\nStarlake will compare the schema of the table with the schema of the expected data file and will raise an error if they do not match."]}),"\n",(0,r.jsxs)(t.p,{children:["The test will pass if the transform task succeeds and the data in the table matches the data in the ",(0,r.jsx)(t.code,{children:"_expected.csv"})," file."]}),"\n",(0,r.jsxs)(t.p,{children:["The reports of the test ",(0,r.jsx)(t.code,{children:"test-name"})," are stored in the ",(0,r.jsx)(t.code,{children:"test-reports/transform/test-name"})," directory and contain the following files:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"test-reports/transform/test-name/testname.db"}),": the actual database after the load task is run. This database contains the following tables:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"sl_expected: The expected data."}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"starbake.product"}),": The actual data."]}),"\n",(0,r.jsx)(t.li,{children:"sl_expectations: The results of the execution of any the expectation related to this table."}),"\n",(0,r.jsx)(t.li,{children:"audit.audit: The audit log of the transform task."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"test-reports/transform/test-name/not_expected.csv"}),": the unexpected data in the actual table after the transform task is run."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"test-reports/transform/test-name/missing.csv"}),": the missing data in the actual table after the transform task is run."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The test reports are generated using the ",(0,r.jsx)(t.code,{children:"starlake test"})," task."]}),"\n",(0,r.jsx)(t.p,{children:"To run the transform tests without running load tests, use the following command:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"starlake test --transform\n"})}),"\n",(0,r.jsxs)(t.p,{children:["To run a specific test use the ",(0,r.jsx)(t.code,{children:"--name"})," flag:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"starlake test --name starbake.product.test-name\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Running tests will also generate a complete website report in the ",(0,r.jsx)(t.code,{children:"test-reports"})," directory."]}),"\n",(0,r.jsx)(t.h2,{id:"example-load--summary-report",children:"Example: Load  summary report"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:s(19367).A+"",width:"768",height:"377"})}),"\n",(0,r.jsx)(t.h2,{id:"example-transform-test-report",children:"Example: Transform Test report"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:s(5402).A+"",width:"783",height:"576"})}),"\n",(0,r.jsx)(t.h2,{id:"example-load--transform-report",children:"Example: Load & Transform report"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:s(92082).A+"",width:"768",height:"425"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},19367:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/load-summary-e46b35d6c4082a8664bbb20ceb83ace0.png"},92082:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/report-f0a008ed2359a2a4af3738eb28b19b53.png"},5402:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/transform-98e87387c51455f62f0d6a35e1d05cab.png"},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>o});var r=s(96540);const a={},n=r.createContext(a);function i(e){const t=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);