"use strict";(self.webpackChunkstarlake=self.webpackChunkstarlake||[]).push([[2719],{19282:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=n(74848),r=n(28453);const a={},d="Transform on load",s={id:"guides/load/transform",title:"Transform on load",description:"Add new attributes",source:"@site/docs/0300-guides/200-load/200-transform.mdx",sourceDirName:"0300-guides/200-load",slug:"/guides/load/transform",permalink:"/starlake/docs/next/guides/load/transform",draft:!1,unlisted:!1,editUrl:"https://github.com/starlake-ai/starlake/edit/master/docs/docs/0300-guides/200-load/200-transform.mdx",tags:[],version:"current",sidebarPosition:200,frontMatter:{},sidebar:"starlakeSidebar",previous:{title:"Type validation",permalink:"/starlake/docs/next/guides/load/validate"},next:{title:"Access control",permalink:"/starlake/docs/next/guides/load/security"}},o={},l=[{value:"Add new attributes",id:"add-new-attributes",level:2},{value:"Ignore attributes",id:"ignore-attributes",level:2},{value:"Foreign key attributes",id:"foreign-key-attributes",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"transform-on-load",children:"Transform on load"}),"\n",(0,i.jsx)(t.h2,{id:"add-new-attributes",children:"Add new attributes"}),"\n",(0,i.jsx)(t.p,{children:"You may add extra attributes during load. This is useful to add extra columns that are not present in the source file such as the current timestamp or the file name"}),"\n",(0,i.jsx)(t.p,{children:"You may use any Spark SQL function to define the value of the new column and this function may reference any column of the same record in the file being loaded including the ignored ones."}),"\n",(0,i.jsxs)(t.p,{children:["The new column will be added to the table with the name you provide in the ",(0,i.jsx)(t.code,{children:"name"})," property and the value will be the result of the function you provide in the ",(0,i.jsx)(t.code,{children:"script"})," property."]}),"\n",(0,i.jsxs)(t.p,{children:["In addition to the ",(0,i.jsx)(t.a,{href:"https://spark.apache.org/docs/latest/api/sql/index.html#hex",children:"Spark SQL"})," functions you can reference any of the properties available in the ",(0,i.jsx)(t.code,{children:"_metadata"})," hidden column."]}),"\n",(0,i.jsx)(t.p,{children:"Available metadata properties are :"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Property"}),(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"file_name"})}),(0,i.jsx)(t.td,{children:"string"}),(0,i.jsx)(t.td,{children:"the name of the file being loaded"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"file_path"})}),(0,i.jsx)(t.td,{children:"string"}),(0,i.jsx)(t.td,{children:"the path of the file being loaded"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"file_size"})}),(0,i.jsx)(t.td,{children:"long"}),(0,i.jsx)(t.td,{children:"the size of the file being loaded"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"file_modification_time"})}),(0,i.jsx)(t.td,{children:"timestamp"}),(0,i.jsx)(t.td,{children:"the last modified date of the file being loaded"})]})]})]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(t.p,{children:["Below is an example of how to add a new column ",(0,i.jsx)(t.code,{children:"file_name"})," to the table that will contain the name of the file being loaded."]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="metadata/load/<domain>/<table>.sl.yml" {8,10,12}',children:'table:\n  pattern: "order_line.*.csv"\n  ...\n  attributes:\n  ...\n  - name: "total_price"\n    script: "quantity * sale_price"\n  - name: "quantity_in_hexadecimal"\n    script: "hex(quantity)"\n  - name: "file_name"\n    script: "_metadata.file_name"\n\n'})}),"\n",(0,i.jsx)(t.h2,{id:"ignore-attributes",children:"Ignore attributes"}),"\n",(0,i.jsx)(t.p,{children:"You may ignore columns during load. This is useful to avoid loading columns that are not needed in the target table or have sensitive data (GDPR)."}),"\n",(0,i.jsxs)(t.p,{children:["To ignore a column, set the ",(0,i.jsx)(t.code,{children:"ignore"})," attribute to ",(0,i.jsx)(t.code,{children:"true"})," in the column definition."]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["You may ignore a column you use inside the ",(0,i.jsx)(t.code,{children:"script"})," attribute of another column."]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="metadata/load/<domain>/<table>.sl.yml" {8,10,12}',children:'table:\n  pattern: "order_line.*.csv"\n  ...\n  attributes:\n  ...\n  - name: "product_id"\n    type: "int"\n    ignore: true\n'})}),"\n",(0,i.jsx)(t.h2,{id:"foreign-key-attributes",children:"Foreign key attributes"}),"\n",(0,i.jsxs)(t.p,{children:["You may define a foreign key on a column during load using the ",(0,i.jsx)(t.code,{children:"foreignKey"})," property on an attribute. This will be set as a foreign key in the target table.\nSome databases may not support foreign keys, in this case, the foreign key will be ignored but will still appear in the autogenerated entity-relational diagram."]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="metadata/load/<domain>/<table>.sl.yml" {8}',children:'table:\n  pattern: "order_line.*.csv"\n  ...\n  attributes:\n  ...\n  - name: "product_id"\n    type: "int"\n    foreignKey: "product.id"\n\n'})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"foreignKey"})," property is defined using one of the following syntax:"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Syntax"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:'foreign_key: "<table>"'})}),(0,i.jsx)(t.td,{children:"This will create a foreign key on the primary key of the specified table in the same domain."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:'foreign_key: "<domain>.<table>"'})}),(0,i.jsx)(t.td,{children:"This will create a foreign key on the column to primary key of the specified table of the specified domain."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:'foreign_key: "<domain>.<table>.<column>"'})}),(0,i.jsx)(t.td,{children:"This will create a foreign key on the column to the specified column in the specified table of the specified domain."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:'foreign_key: "<table>.<column>"'})}),(0,i.jsx)(t.td,{children:"This will create a foreign key on the column to the specified column in the specified table in the same domain"})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>s});var i=n(96540);const r={},a=i.createContext(r);function d(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);