<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.8.0 plugin-docs plugin-id-default docs-doc-id-reference/configuration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Configuration | Supercharge your data pipelines</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://starlake-ai.github.io/starlake/docs/reference/configuration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.8.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.8.0"><meta data-rh="true" name="docsearch:version" content="0.8.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.8.0"><meta data-rh="true" property="og:title" content="Configuration | Supercharge your data pipelines"><meta data-rh="true" name="description" content="To run it with the default configuration, you simply launch it as follows :"><meta data-rh="true" property="og:description" content="To run it with the default configuration, you simply launch it as follows :"><link data-rh="true" rel="icon" href="/starlake/img/favicon_starlake.ico"><link data-rh="true" rel="canonical" href="https://starlake-ai.github.io/starlake/docs/reference/configuration"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/reference/configuration" hreflang="en"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/reference/configuration" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/starlake/blog/rss.xml" title="Supercharge your data pipelines RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/starlake/blog/atom.xml" title="Supercharge your data pipelines Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-207943293-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FYS72XYD48"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FYS72XYD48",{anonymize_ip:!0})</script><link rel="stylesheet" href="/starlake/assets/css/styles.2ea9b6e7.css">
<link rel="preload" href="/starlake/assets/js/runtime~main.5fb86bce.js" as="script">
<link rel="preload" href="/starlake/assets/js/main.e97a5234.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/starlake/"><div class="navbar__logo"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--light_HNdA"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Starlake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/starlake/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/starlake/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/starlake/docs/intro">0.8.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/starlake/docs/next/intro">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/starlake/docs/reference/configuration">0.8.0</a></li></ul></div><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a><a href="https://starlakeai.slack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/starlake/docs/intro">What is Starlake ?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/starlake/docs/quickstart/install">Quickstart</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/starlake/docs/userguide/example">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/starlake/docs/reference/configuration">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/starlake/docs/reference/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/environment">Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/extract">Extract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/load">Load</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/transform">Transform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/examples">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/scheduling">Scheduling</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/starlake/docs/platform/aws">Platform Specific</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/starlake/docs/cli/bq-freshness">CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/starlake/docs/devguide/contribute">Developer Guide</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/starlake/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configuration</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.8.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuration</h1></header><p>To run it with the default configuration, you simply launch it as follows :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ starlake.sh COMMAND </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ARGS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>COMMAND: Any of the command described in the CLI section followed by optional arguments</li><li>ARGS: Option list of command arguments</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="applicationslyml">application.sl.yml<a href="#applicationslyml" class="hash-link" aria-label="Direct link to application.sl.yml" title="Direct link to application.sl.yml">​</a></h3><p>You may also pass any Spark arguments as usual but also pass a custom <code>application.sl.yml</code> file .
default settings are found in the <a href="https://github.com/starlake-ai/starlake/blob/master/src/main/resources/reference.conf" target="_blank" rel="noopener noreferrer">reference.conf</a>
and <a href="https://github.com/starlake-ai/starlake/tree/master/src/main/resources" target="_blank" rel="noopener noreferrer">reference-*.conf</a> files. In your <code>application.sl.yml</code>file you only
need to redefine the variables you want to customize.</p><p>Some of those configurations may also be redefined through environment variables.</p><ul><li>In client mode: To pass those env vars, simply export / set them before calling starlake.</li><li>In cluster mode, you need to pass them as extra driver options.</li></ul><p>An <code>application.sl.yml</code> file stored in the metadata subdirectory will be automatically loaded by Starlake. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">Environment variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment variables" title="Direct link to Environment variables">​</a></h3><ul><li><p>On Premise: To pass Starlake Data Pipeline env vars in cluster mode, you&#x27;ll have to put them in the spark-defaults.conf file or pass them as arguments to your
Spark job as described in this <a href="https://stackoverflow.com/questions/37887168/how-to-pass-environment-variables-to-spark-driver-in-cluster-mode-with-spark-sub" target="_blank" rel="noopener noreferrer">article</a></p></li><li><p>On Google Cloud: To make it available for all your jobs, you need to pass them in the <code>DataprocClusterCreateOperator</code> using the <code>spark-env:</code>prefix
as described in the example below:</p></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    create_cluster </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DataprocClusterCreateOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;create_dataproc_cluster&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cluster_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CLUSTER_NAME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        num_workers</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;${dataproc_cluster_size}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        zone</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ZONE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        region</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${region}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tags </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dataproc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        storage_bucket </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dataproc-${project_id}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image_version</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2.0.1-debian10&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        master_machine_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">MASTER_MACHINE_TYPE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        worker_machine_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">WORKER_MACHINE_TYPE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service_account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${service_account}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        internal_ip_only </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        subnetwork_uri </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;projects/${project_id}/regions/${region}/subnetworks/${subnet}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        properties </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:SL_FS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gs://${my_bucket}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:SL_HIVE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:SL_GROUPED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:SL_AUDIT_SINK_TYPE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BigQuerySink&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, the variables are available in all the tasks that will be started on this cluster.</p><p>To set variables for specific tasks only, use a syntax similar to this one:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">t1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dataproc_operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DataProcSparkOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  task_id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my_task&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dataproc_spark_jars</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;gs://my-bucket/starlake-spark3_2.12-VERSION-assembly.jar&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cluster_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cluster&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  main_class </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ai.starlake.job.Main&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  arguments</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  project_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my-project-id&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dataproc_spark_properties</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;spark.driver.extraJavaOptions&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;-DSL_FS=gs://${my_bucket} -DSL_HIVE=false -DSL_GROUPED=false&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Starlake allows you to override some configurations properties using predefined env variables prefixed by <code>SL_</code>.
In addition, you may override any configuration option by setting the JVM property <code>-Dconfig.override_with_env_vars=true</code> and using the prefix
<code>CONFIG_FORCE_</code> as explained below:</p><ul><li>prefix the property name with <code>CONFIG_FORCE_</code></li><li>use single underscore <code>_</code> for a dot <code>.</code></li><li>use double underscore <code>__</code> for a dash <code>-</code></li><li>use triple undercore <code>___</code>for a single underscore <code>_</code></li></ul><p>For example, to redefine the property <code>metrics.discrete-max-cardinality</code> with the value <code>100</code>,
you need to set it as a JVM property using the syntax <code>-DCONFIG_FORCE_metrics_discrete__max__cardinality=100</code></p><p>For more details, please refer to the official <a href="https://github.com/lightbend/config#optional-system-or-env-variable-overrides" target="_blank" rel="noopener noreferrer">typesafeconfig</a> documentation. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-sections">Configuration sections<a href="#configuration-sections" class="hash-link" aria-label="Direct link to Configuration sections" title="Direct link to Configuration sections">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="filesystem">Filesystem<a href="#filesystem" class="hash-link" aria-label="Direct link to Filesystem" title="Direct link to Filesystem">​</a></h3><p>A filesystem is the location where datasets and Starlake Data Pipeline metadata used for ingestion are stored.</p><ul><li>On premise this reference the folder where datasets and metadata are stored, eq.<ul><li>On a local filesystem: file://</li><li>On a HDFS: hdfs://localhost:9000</li></ul></li><li>In the cloud:<ul><li>On Google Cloud Platform: gs://my-bucket</li><li>On Microsoft Azure: abfs://<a href="mailto:my-bucket@starlake.dfs.core.windows.net" target="_blank" rel="noopener noreferrer">my-bucket@starlake.dfs.core.windows.net</a></li><li>On Amazon Web Service: s3a://my_bucket</li></ul></li></ul><p>By default, Starlake expect metadata in the /tmp/metadata folder and will store ingested datasets in the /tmp/datasets folder.
Below is how the folders look like by default for the provided quickstart sample.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /tmp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |-- datasets (Root folder of ingested datasets)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- accepted (Root folder of all valid records)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (domain name as specified in the name attribute of the /tmp/metadata/hr.yml)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers (Schema name as specified in the /tmp/metadata/hr.yml)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       `-- part-00000-292c081b-7291-4797-b935-17bc9409b03b.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers (valid records for this schema as specified in the /tmp/metadata/sales.yml)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   `-- part-00000-562501a1-34ef-4b94-b527-8e93bcbb5f89.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders (valid records for this schema as specified in the /tmp/metadata/sales.yml)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           `-- part-00000-92544093-4ae2-4a98-8df8-a5aba19a1b27.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- archive (Source files as found in the incoming folder are saved here after processing)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (Domain name)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers-2018-01-01.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers-2018-01-01.psv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders-2018-01-01.csv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- business</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- discrete</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- continuous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- frequencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- ingesting (Temporary folder used during ingestion by Starlake)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (One temporary subfolder / domain)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- pending (Source files are copied here from the incoming folder before processing)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (one folder / domain)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- rejected (invalid records in processed datasets are stored here)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (Domain name)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers (Schema name)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       `-- part-00000-aef2dde6-af24-4e20-ad88-3e5238916e57.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   `-- part-00000-e6fa5ff9-ad29-4e5f-a5ff-549dd331fafd.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           |-- _SUCCESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           `-- part-00000-6f7ba5d4-960b-4ac6-a123-87a7ab2d212f.snappy.parquet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   `-- unresolved (Files found in the incoming folder but do not match any schema)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |       `-- hr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |           `-- dummy.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    `-- metadata (Root of metadata files)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |-- load (all domain definition files are located in this folder)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- hr/_config.sl.yml (One definition file / domain)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- hr/sales.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- assertions (All assertion definitions go here)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- default.sl.yml (Predefined assertion definitions)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- assertions.sl.yml (assertion definitions defined here are accessible throughout the project)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- types (All semantic types are defined here)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- default.sl.yml (Default semantic types)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- types.sl.yml (User defined semantic types, overwrite default ones)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- transform (All transform jobs go here)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            `-- hr/sales_by_name.sql (Compute sales by )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Starlake Data Pipeline allows you to store datasets and metadata in two different filesystems. Thi is useful if you want to define a specific lifecycle
for your datasets.
Almost all options are customizable through environnement variables.
The main env vars are described below, you may change default settings. The exhaustive list of predefined env vars can be found in the reference.conf file.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">root</td><td align="left">SL_ROOT</td><td align="left">/tmp</td><td align="left">Root directory of the datasets and metadata files in the defined filesystem above</td></tr><tr><td align="left">datasets</td><td align="left">SL_DATASETS</td><td align="left">${root}&quot;/datasets&quot;</td><td align="left">Folder where datasets are located in the datasets <code>file-system</code></td></tr><tr><td align="left">metadata</td><td align="left">SL_METADATA</td><td align="left">${root}&quot;/metadata&quot; otherwise</td><td align="left">Folder where metadata are located in the metadata <code>metadata-file-system</code></td></tr><tr><td align="left">area.pending</td><td align="left">SL_AREA_PENDING</td><td align="left">pending</td><td align="left">Source files are copied here from the incoming folder before processing</td></tr><tr><td align="left">area.unresolved</td><td align="left">SL_AREA_UNRESOLVED</td><td align="left">unresolved</td><td align="left">Files found in the incoming folder but do not match any schema</td></tr><tr><td align="left">area.archive</td><td align="left">SL_AREA_ARCHIVE</td><td align="left">archive</td><td align="left">Source files as found in the incoming folder are saved here after processing</td></tr><tr><td align="left">area.ingesting</td><td align="left">SL_AREA_INGESTING</td><td align="left">ingesting</td><td align="left">Temporary folder used during ingestion by Starlake</td></tr><tr><td align="left">area.accepted</td><td align="left">SL_AREA_ACCEPTED</td><td align="left">accepted</td><td align="left">root folder of all valid records</td></tr><tr><td align="left">area.rejected</td><td align="left">SL_AREA_REJECTED</td><td align="left">rejected</td><td align="left">invalid records in processed datasets are stored here</td></tr><tr><td align="left">area.business</td><td align="left">SL_AREA_BUSINESS</td><td align="left">business</td><td align="left">root folder for all datasets produced by autojobs</td></tr><tr><td align="left">archive</td><td align="left">SL_ARCHIVE</td><td align="left">true</td><td align="left">Should we archive the incoming files once they are ingested</td></tr><tr><td align="left">default-write-format</td><td align="left">SL_DEFAULT_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How accepted records are stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">default-rejected-write-format</td><td align="left">SL_DEFAULT_REJECTED_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How rejected records are stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">default-audit-write-format</td><td align="left">SL_DEFAULT_AUDIT_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How audit is stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">hive</td><td align="left">SL_HIVE</td><td align="left">true</td><td align="left">Should we create external Hive tables for ingested files ?</td></tr><tr><td align="left">analyze</td><td align="left">SL_ANALYZE</td><td align="left">true</td><td align="left">Should we computed basic statistics ? (requires SL_HIVE to be set to true)</td></tr><tr><td align="left">launcher</td><td align="left">SL_LAUNCHER</td><td align="left">simple</td><td align="left">Which orchestrator to use ? Valid values are airflow or simple (direct call)</td></tr></tbody></table><p>To make sure, the same schema is not ingested by two concurrent Starlake processes, Starlake Data Pipeline uses a file lock when necessary.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">lock.path</td><td align="left">SL_LOCK_PATH</td><td align="left">${root}&quot;/locks&quot;</td><td align="left">Root folder where lock file is created</td></tr><tr><td align="left">lock.timeout</td><td align="left">SL_LOCK_TIMEOUT</td><td align="left">-1</td><td align="left">How long to wait for the file lock to be available (in seconds)</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ingestion">Ingestion<a href="#ingestion" class="hash-link" aria-label="Direct link to Ingestion" title="Direct link to Ingestion">​</a></h3><p>When many files that have the same pattern and thus belong to the same schema, it is possible to ingest them one after the other using an ingestion policy
or ingest all of them at once.</p><p>When ingesting the files with the same schema one after the other, it is possible to use a custom ordering policy by settings the <code>SL_LOAD_STRATEGY</code> environment variable. Currently, the following ordering policies are defined:</p><ul><li><code>ai.starlake.job.load.IngestionTimeStrategy</code> : Order the files by modification date</li><li><code>ai.starlake.job.load.IngestionNameStrategy</code> : Order  the files by name</li></ul><p>If you want to use another custom strategy, you&#x27;ll have to implement the trait below, make it available in the classpath and set the <code>SL_LOAD_STRATEGY</code> environment variable</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">ai</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">starlake</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">job</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">load</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">java</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">time</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">LocalDateTime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">org</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">apache</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">hadoop</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">fs</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">FileSystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">trait</span><span class="token plain"> LoadStrategy </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** List all files in folder</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @param fs        FileSystem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @param path      Absolute folder path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @param extension Files should end with this string. To list all files, simply provide an empty string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @param since     Minimum modification time of list files. To list all files, simply provide the beginning of all times</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @param recursive List files recursively</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    * @return List of Path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> FileSystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">extension</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">String</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    since</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> LocalDateTime </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> LocalDateTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    recursive</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">Boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">Path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To ingest all the files at once, set the <code>SL_GROUPED</code> variable to true.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">grouped</td><td align="left">SL_GROUPED</td><td align="left">false</td><td align="left">Should files with the same schema be ingested all at once ?</td></tr><tr><td align="left">load-strategy-class</td><td align="left">SL_LOAD_STRATEGY</td><td align="left">ai.starlake.job.load.IngestionTimeStrategy</td><td align="left">When <code>grouped</code> is false, which ingestion order strategy to use</td></tr></tbody></table><p>Below is an example of HOCON file with the default values.</p><div class="language-hocon codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hocon codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">load-strategy-class = &quot;ai.starlake.job.load.IngestionTimeStrategy&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">load-strategy-class = ${?SL_LOAD_STRATEGY}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grouped = false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grouped = ${?SL_GROUPED}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The YAML/HOCON file describing the schema and ingestion rules may also define a custom sink (FS / JDBC / BigQuery / Redshift ...). </p><p>In test mode, we need to sink the files to the filesystem. To enable sinking the resulting parquet file even when another sink type is desired, simply
set the <code>SL_SINK_TO_FILE</code> environment variable to <code>true</code>.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">sink-to-file</td><td align="left">SL_SINK_TO_FILE</td><td align="left">false</td><td align="left">Should ingested files be stored on the filesystem on only in the sink defined in the YAML file ?</td></tr></tbody></table><div class="language-hocon codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hocon codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sink-to-file = false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sink-to-file = ${?SL_SINK_TO_FILE}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>sink to file</code> or a filesystem sink (SinkType.FS) is requested, and you want to output the result in a single file in the csv file format, set the <code>SL_CSV_OUTPUT</code>
environment variable to <code>true</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">​</a></h3><p>During ingestion, the input file is validated up to the attribute level. Three default row validators are defined:</p><ul><li>ai.starlake.job.validator.FlatRowValidator: to validate flat files, eq. DSV, Position and single level Json files.</li><li>ai.starlake.job.validator.TreeRowValidator:  used for tree like documents, eq. XML and JSON files</li><li>ai.starlake.job.validator.AcceptAllValidator: used for any document type (flat and tree like) and accept the input without any validation</li></ul><p>The validtor to use is configurable as follows:</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env. variable</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">row-validator-class</td><td align="left">SL_ROW_VALIDATOR_CLASS</td><td align="left">ai.starlake.job.validator.FlatRowValidator</td></tr><tr><td align="left">tree-validator-class</td><td align="left">SL_TREE_VALIDATOR_CLASS</td><td align="left">ai.starlake.job.validator.TreeRowValidator</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="privacy">Privacy<a href="#privacy" class="hash-link" aria-label="Direct link to Privacy" title="Direct link to Privacy">​</a></h3><p>Default valid values are NONE, HIDE, MD5, SHA1, SHA256, SHA512, AES(not implemented).
Custom values may also be defined by adding a new privacy option in the application.conf.
The default reference.conf file defines the following valid privacy strategies:</p><div class="language-hocon codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hocon codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">privacy {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  options = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;none&quot;: &quot;ai.starlake.privacy.No&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hide&quot;: &quot;ai.starlake.privacy.Hide&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hide10X&quot;: &quot;ai.starlake.privacy.Hide(\&quot;X\&quot;,10)&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;approxLong20&quot;: &quot;ai.starlake.privacy.ApproxLong(20)&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;md5&quot;: &quot;ai.starlake.privacy.Md5&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha1&quot;: &quot;ai.starlake.privacy.Sha1&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha256&quot;: &quot;ai.starlake.privacy.Sha256&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha512&quot;: &quot;ai.starlake.privacy.Sha512&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;initials&quot;: &quot;ai.starlake.privacy.Initials&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the YAML/HOCON file, reference, you reference the option name. This will apply the function defined in the class referenced by the option value.</p><p>Below the predefined strategies:</p><table><thead><tr><th align="left">Privacy Strategy</th><th align="left">Privacy class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">none</td><td align="left">ai.starlake.privacy.No</td><td align="left">Return the input string itself</td></tr><tr><td align="left">hide</td><td align="left">ai.starlake.privacy.Hide(\&quot;X\&quot;, 10)</td><td align="left">Without a parameter, return the empty string. Otherwise, replace with 10 occurrences of the character &#x27;X&#x27;</td></tr><tr><td align="left">md5</td><td align="left">ai.starlake.privacy.Md5</td><td align="left">Return the md5 of the input string</td></tr><tr><td align="left">sha1</td><td align="left">ai.starlake.privacy.Sha1</td><td align="left">Return the sha1 of the input string</td></tr><tr><td align="left">sha256</td><td align="left">ai.starlake.privacy.Sha256</td><td align="left">Return the sha256 of the input string</td></tr><tr><td align="left">sha512</td><td align="left">ai.starlake.privacy.Sha512</td><td align="left">Return the sha256 of the input string</td></tr><tr><td align="left">initials</td><td align="left">ai.starlake.privacy.Initials</td><td align="left">Return the first char of each word (usually applied to user names)</td></tr></tbody></table><p>The following startegies are also defined and may be declared in the custom configuration file.</p><table><thead><tr><th align="left">Privacy class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">ai.starlake.privacy.IPv4(8)</td><td align="left">Return the IPv4 address with the last 8 bytes masked</td></tr><tr><td align="left">ai.starlake.privacy.IPv6(8</td><td align="left">Return the IPv6 address with the last 8 bytes masked</td></tr><tr><td align="left">ai.starlake.privacy.RandomDouble</td><td align="left">Return a random double number</td></tr><tr><td align="left">ai.starlake.privacy.RandomDouble(10,20)</td><td align="left">Return a random double between 10.0 and 20.0</td></tr><tr><td align="left">ai.starlake.privacy.RandomLong</td><td align="left">Return a random long number</td></tr><tr><td align="left">ai.starlake.privacy.RandomLong(10, 20)</td><td align="left">Return a random long number between 10 and 20</td></tr><tr><td align="left">ai.starlake.privacy.RandomInt</td><td align="left">Return a random int number</td></tr><tr><td align="left">ai.starlake.privacy.RandomInt(10, 20)</td><td align="left">Return a random int number between 10 and 20</td></tr><tr><td align="left">ai.starlake.privacy.ApproxDouble(70)</td><td align="left">Return a double value with a variation up to 70% applied to the input value</td></tr><tr><td align="left">ai.starlake.privacy.ApproxLong(70)</td><td align="left">Return a double long with a variation up to 70% applied to the input value</td></tr><tr><td align="left">ai.starlake.privacy.Mask(\&quot;*\&quot;, 4, 1, 3)</td><td align="left">Partially mask the input value with 4 occurrences of the &#x27;*&#x27; character, 1 on the left side and 3 on the right side.</td></tr></tbody></table><p>Any new privacy strategy should implement the following trait :</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** @param s: String  =&gt; Input string to encrypt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param colMap : Map[String, Option[String]] =&gt; Map of all the attributes and their corresponding values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param params: List[Any]  =&gt; Parameters passed to the algorithm as defined in the conf file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  *                               Parameter starting with &#x27;&quot;&#x27; is converted to a string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  *                               Parameter containing a &#x27;.&#x27; is converted to a double</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  *                               Parameter equals to true of false is converted a boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  *                               Anything else is converted to an int</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @return The encrypted string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sinks">Sinks<a href="#sinks" class="hash-link" aria-label="Direct link to Sinks" title="Direct link to Sinks">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bigquery-sink">BigQuery Sink<a href="#bigquery-sink" class="hash-link" aria-label="Direct link to BigQuery Sink" title="Direct link to BigQuery Sink">​</a></h4><p>When type field is set to <code>BigQuerySink</code></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">location</td><td align="left">String</td><td align="left">EU</td><td align="left">Database location (EU, US, ...)</td></tr><tr><td align="left">timestamp</td><td align="left">String</td><td align="left">None</td><td align="left">The timestamp column to use for table partitioning if any. No partitioning by default</td></tr><tr><td align="left">clustering</td><td align="left">List</td><td align="left">None</td><td align="left">List of ordered columns to use for table clustering</td></tr><tr><td align="left">days</td><td align="left">Int</td><td align="left">None</td><td align="left">Number of days before this table is set as expired and deleted. Never by default.</td></tr><tr><td align="left">requirePartitionFilter</td><td align="left">Boolean</td><td align="left">false</td><td align="left">Should be require a partition filter on every request ? No by default.</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left">Spark or BigQuery (depend on the selected engine) options to be set on the BigQuery connection</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch-sink">Elasticsearch Sink<a href="#elasticsearch-sink" class="hash-link" aria-label="Direct link to Elasticsearch Sink" title="Direct link to Elasticsearch Sink">​</a></h4><p>When type field is set to <code>EsSink</code></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">id</td><td align="left">String</td><td align="left">None</td><td align="left">Attribute to use as id of the document. Generated by Elasticseach if not specified.</td></tr><tr><td align="left">timestamp</td><td align="left">String</td><td align="left">None</td><td align="left">Timestamp field format as expected by Elasticsearch (&quot;{beginTs<!-- -->|<!-- -->yyyy.MM.dd}&quot; for example).</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left">Elasticsearch options to be set on the ES connection</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="filesystem-sink">Filesystem Sink<a href="#filesystem-sink" class="hash-link" aria-label="Direct link to Filesystem Sink" title="Direct link to Filesystem Sink">​</a></h4><p>When type field is set to <code>FsSink</code>. FsSink est the default sink type when ingesting data.
The file where data is saved is computed using the domain and schema name. See <a href="/starlake/docs/userguide/load">Load</a> and <a href="/starlake/docs/userguide/transform">Transform</a></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">connection</td><td align="left">String</td><td align="left">None</td><td align="left">JDBC Connection String</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left"><a href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html" target="_blank" rel="noopener noreferrer">JDBC Options</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="audit">Audit<a href="#audit" class="hash-link" aria-label="Direct link to Audit" title="Direct link to Audit">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics">​</a></h3><p>During ingestion, Starlake may produce metrics for any attribute in the dataset. Currently, only top level attributes are supported.
One of the two available metric type may be specified on an attribute: continuous and discrete.
When the <code>metric</code> property is set to <code>continuous</code>, Starlake will compute for this attribute the following metrics:</p><ul><li>minimum value</li><li>maximum value</li><li>sum of all values</li><li>mean: The arithmetic average</li><li>median: the value separating the higher half from the lower half, may be thought of as &quot;the middle&quot; value</li><li>variance: How far the values are spread out from their average value.</li><li>standard deviation: square root of the variance, the standard deviation measures how spread out numbers are in a data set</li><li>missing values</li><li>skewness: The measure of the asymmetry of the probability distribution. Negative skew commonly indicates that the tail is on the left side of the distribution, and positive skew indicates that the tail is on the right.</li><li>kurtosis: It tells us the extent to which the distribution is more or less outlier-prone (heavier or light-tailed) than the normal distribution. The greater the kurtosis, the less precise the standard deviation and variance become.</li><li>25th percentile: Returns the approximate <code>25 percentile</code> of this attribute which is the smallest value in the ordered attribute values (sorted from least to greatest) such that no more than <code>25%</code> of attribute values is less than the value or equal to that value</li><li>75 percentile: Returns the approximate <code>75 percentile</code> of this attribute which is the smallest value in the ordered attribute values (sorted from least to greatest) such that no more than <code>75%</code> of attribute values is less than the value or equal to that value</li><li>row count </li></ul><p>When the <code>metric</code> property is set to <code>discrete</code>, Starlake will compute for this attribute the following metrics:</p><ul><li>count distinct: The number of distinct values for this attribute</li><li>category frequency: The frequency (percentage) for each distinct value for this attribute</li><li>category count: The number of occurrences for each distinct value for this attribute</li><li>row count</li></ul><p>Each metric is computed for each attribute only on the incoming dataset and stored in a table with the ingestion time allowing to compare metric values between loads.</p><p>Assuming we are ingesting a file with the following schema:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- business_id: string (nullable = false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- name: string (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- address: string (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- city: string (nullable = true) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- state: string (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- postal_code: string (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- latitude: double (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- longitude: double (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- stars: double (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- review_count: long (nullable = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|-- is_open: long (nullable = true)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>with the attributes <code>city</code> is marked as discrete and <code>review_count</code> is marked as continuous</p><p>The following tables would be generated:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-------------+---------------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|attribute  |countDistinct|missingValuesDiscrete|cometMetric|jobId              |domain|schema  |count|cometTime    |cometStage|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-------------+---------------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city       |53           |0                    |Discrete   |local-1650471634299|yelp  |business|200  |1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+-----------+-------------+---------------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+------------+---+-----+------+-------------+--------+-----------+------+--------+--------+------------+------+------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|attribute   |min|max  |mean  |missingValues|variance|standardDev|sum   |skewness|kurtosis|percentile25|median|percentile75|cometMetric|jobId              |domain|schema  |count|cometTime    |cometStage|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+------------+---+-----+------+-------------+--------+-----------+------+--------+--------+------------+------+------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|review_count|3.0|664.0|38.675|0            |7974.944|89.303     |7735.0|4.359   |21.423  |5.0         |9.0   |25.0        |Continuous |local-1650471634299|yelp  |business|200  |1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+------------+---+-----+------+-------------+--------+-----------+------+--------+--------+------------+------+------------+-----------+-------------------+------+--------+-----+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+---------------+-----+---------+-------------------+------+--------+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|attribute|category       |count|frequency|jobId              |domain|schema  |cometTime    |cometStage|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+---------------+-----+---------+-------------------+------+--------+-------------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Tempe          |200  |0.01     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |North Las Vegas|200  |0.01     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Phoenix        |200  |0.085    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |West Mifflin   |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Newmarket      |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Wickliffe      |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |McKeesport     |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Scottsdale     |200  |0.06     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Scarborough    |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Wexford        |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Willoughby     |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Chandler       |200  |0.02     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Surprise       |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Cleveland      |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Litchfield Park|200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Verona         |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Richmond Hill  |200  |0.01     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Hudson         |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Etobicoke      |200  |0.01     |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |Cuyahoga Falls |200  |0.005    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|city     |.............. |...  |.....    |local-1650471634299|yelp  |business|1650471642737|UNIT      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+---------------+-----+---------+-------------------+------+--------+-------------+----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expectations">Expectations<a href="#expectations" class="hash-link" aria-label="Direct link to Expectations" title="Direct link to Expectations">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch">Elasticsearch<a href="#elasticsearch" class="hash-link" aria-label="Direct link to Elasticsearch" title="Direct link to Elasticsearch">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spark">Spark<a href="#spark" class="hash-link" aria-label="Direct link to Spark" title="Direct link to Spark">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kafka">Kafka<a href="#kafka" class="hash-link" aria-label="Direct link to Kafka" title="Direct link to Kafka">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jdbc">JDBC<a href="#jdbc" class="hash-link" aria-label="Direct link to JDBC" title="Direct link to JDBC">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="µ-service">µ-service<a href="#µ-service" class="hash-link" aria-label="Direct link to µ-service" title="Direct link to µ-service">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="airflow">Airflow<a href="#airflow" class="hash-link" aria-label="Direct link to Airflow" title="Direct link to Airflow">​</a></h3><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"></td><td align="left">AIRFLOW_ENDPOINT</td><td align="left">Airflow endpoint. Used when SL_LAUNCHER is set to airflow</td><td align="left"><a href="http://127.0.0.1:8080/api/experimental" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080/api/experimental</a></td></tr></tbody></table><table><thead><tr><th>Env. Var</th><th>Description</th><th>Default value</th></tr></thead></table><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>When running Spark on YARN in cluster mode,
environment variables need to be set using the syntax spark.yarn.appMasterEnv.<!-- -->[EnvironmentVariableName]</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>When running Dataproc on GCP, environment variables need to be set
in the DataprocClusterCreateOperator in the properties attributes
using the syntax &quot;spark-env:<!-- -->[EnvironmentVariableName]<!-- -->&quot;:&quot;<!-- -->[Value]<!-- -->&quot;</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="airflow-dags">Airflow DAGs<a href="#airflow-dags" class="hash-link" aria-label="Direct link to Airflow DAGs" title="Direct link to Airflow DAGs">​</a></h2><p>Starlake Data Pipeline comes with native  Airflow support.
Below are DAG definitions for each of the three ingestion steps on an kerberized cluster.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="import-dag">Import DAG<a href="#import-dag" class="hash-link" aria-label="Direct link to Import DAG" title="Direct link to Import DAG">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*/1 * * * *&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode client </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometImport </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="watch-dag">Watch DAG<a href="#watch-dag" class="hash-link" aria-label="Direct link to Watch DAG" title="Direct link to Watch DAG">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">slack_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SlackAPIPostOperator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;queue&#x27;: &#x27;bash_queue&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;pool&#x27;: &#x27;backfill&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;priority_weight&#x27;: 10,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;end_date&#x27;: datetime(2016, 1, 1),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_watcher&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*/1 * * * *&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">slack_task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slack_alert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SlackAPIPostOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;slack_alert&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channel</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        token</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xoxp-64071012534-475450904118-524897638692-f9a90d49fd7fb312a574b4570d557b9a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        username </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> slack_alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode client </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SL_DOMAIN </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_DOMAIN&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometWatch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_watcher&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; watch &#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> SL_DOMAIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_failure_callback=slack_task(&quot;:red_circle: Task Starlake Watch Failed&quot;),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_success_callback=slack_task(&quot;:ok_hand: Task Starlake Watch Success&quot;),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AIRFLOW_ENDPOINT&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://airflow.my.server.com/api/experimental&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ingestion-dag">Ingestion DAG<a href="#ingestion-dag" class="hash-link" aria-label="Direct link to Ingestion DAG" title="Direct link to Ingestion DAG">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">slack_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SlackAPIPostOperator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_ingest&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">slack_task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slack_alert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SlackAPIPostOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;slack_alert&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channel</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        token</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xoxp-64071012534-475450904118-524897638692-f9a90d49fd7fb312a574b4570d557b9a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        username </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> slack_alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SL_METADATA</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">project</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">metadata \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SL_ACCEPTED</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">working \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SL_DATASETS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">project</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">data \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode cluster </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">templated_command </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SL_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">&quot;&quot;&quot; {{ dag_run.conf[&#x27;command&#x27;] }}&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometIngest </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_ingest&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">templated_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_failure_callback=slack_task(&quot;:red_circle: Task Starlake Ingest Failed: &quot;),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_success_callback=slack_task(&quot;:ok_hand: Task Starlake Ingest Success: &quot;),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SL_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/starlake-ai/starlake/edit/master/docs/versioned_docs/version-0.8.0/reference/1.configuration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/starlake/docs/userguide/transform"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Transform</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/starlake/docs/reference/environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#applicationslyml" class="table-of-contents__link toc-highlight">application.sl.yml</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment variables</a></li></ul></li><li><a href="#configuration-sections" class="table-of-contents__link toc-highlight">Configuration sections</a><ul><li><a href="#filesystem" class="table-of-contents__link toc-highlight">Filesystem</a></li><li><a href="#ingestion" class="table-of-contents__link toc-highlight">Ingestion</a></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#privacy" class="table-of-contents__link toc-highlight">Privacy</a></li><li><a href="#sinks" class="table-of-contents__link toc-highlight">Sinks</a></li><li><a href="#audit" class="table-of-contents__link toc-highlight">Audit</a></li><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a></li><li><a href="#expectations" class="table-of-contents__link toc-highlight">Expectations</a></li><li><a href="#elasticsearch" class="table-of-contents__link toc-highlight">Elasticsearch</a></li><li><a href="#spark" class="table-of-contents__link toc-highlight">Spark</a></li><li><a href="#kafka" class="table-of-contents__link toc-highlight">Kafka</a></li><li><a href="#jdbc" class="table-of-contents__link toc-highlight">JDBC</a></li><li><a href="#µ-service" class="table-of-contents__link toc-highlight">µ-service</a></li><li><a href="#airflow" class="table-of-contents__link toc-highlight">Airflow</a></li></ul></li><li><a href="#airflow-dags" class="table-of-contents__link toc-highlight">Airflow DAGs</a><ul><li><a href="#import-dag" class="table-of-contents__link toc-highlight">Import DAG</a></li><li><a href="#watch-dag" class="table-of-contents__link toc-highlight">Watch DAG</a></li><li><a href="#ingestion-dag" class="table-of-contents__link toc-highlight">Ingestion DAG</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/starlake/docs/intro">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/starlake/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
<ul class="footer_right"><li><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a></li><li><a href="https://starlakeai.slack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a></li></ul>
</li></ul></div></div></div></footer></div>
<script src="/starlake/assets/js/runtime~main.5fb86bce.js"></script>
<script src="/starlake/assets/js/main.e97a5234.js"></script>
</body>
</html>