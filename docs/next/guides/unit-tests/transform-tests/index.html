<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/unit-tests/transform-tests" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Test Transform Tasks | Declarative Data Pipelines</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://starlake-ai.github.io/starlake/docs/next/guides/unit-tests/transform-tests"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Test Transform Tasks | Declarative Data Pipelines"><meta data-rh="true" name="description" content="Test your transform locally before deploying to production."><meta data-rh="true" property="og:description" content="Test your transform locally before deploying to production."><link data-rh="true" rel="icon" href="/starlake/img/favicon_starlake.ico"><link data-rh="true" rel="canonical" href="https://starlake-ai.github.io/starlake/docs/next/guides/unit-tests/transform-tests"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/next/guides/unit-tests/transform-tests" hreflang="en"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/next/guides/unit-tests/transform-tests" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/starlake/blog/rss.xml" title="Declarative Data Pipelines RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/starlake/blog/atom.xml" title="Declarative Data Pipelines Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-207943293-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FYS72XYD48"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FYS72XYD48",{anonymize_ip:!0})</script><link rel="stylesheet" href="/starlake/assets/css/styles.35c0dddb.css">
<link rel="preload" href="/starlake/assets/js/runtime~main.de1a9ea1.js" as="script">
<link rel="preload" href="/starlake/assets/js/main.d3f17b61.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/starlake/"><div class="navbar__logo"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--light_HNdA"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Starlake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/starlake/docs/next/intro">Documentation</a><a class="navbar__item navbar__link" href="/starlake/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/starlake/docs/next/intro">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/starlake/docs/next/guides/unit-tests/transform-tests">Next</a></li><li><a class="dropdown__link" href="/starlake/docs/guides/unit-tests/transform-tests">1.2.0</a></li><li><a class="dropdown__link" href="/starlake/docs/1.1.0/intro">1.1.0</a></li><li><a class="dropdown__link" href="/starlake/docs/1.0.0/intro">1.0.0</a></li></ul></div><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a><a href="https://join.slack.com/t/starlakeai/shared_invite/zt-28vf5d49s-rnyuh70OrJjcX_2Vz2mafw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/starlake/docs/next/intro">What is Starlake ?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/starlake/docs/next/install">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/starlake/docs/next/category/guides">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/next/guides/bootstrap">Create a project</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/starlake/docs/next/category/extract">Extract</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extract&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/starlake/docs/next/category/load">Load</a><button aria-label="Toggle the collapsible sidebar category &#x27;Load&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/starlake/docs/next/category/transform">Transform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/starlake/docs/next/category/unit-tests">Unit Tests</a><button aria-label="Toggle the collapsible sidebar category &#x27;Unit Tests&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/next/guides/unit-tests/load-tests">Test Load Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/starlake/docs/next/guides/unit-tests/transform-tests">Test Transform Tasks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/starlake/docs/next/category/orchestrate">Orchestrate</a><button aria-label="Toggle the collapsible sidebar category &#x27;Orchestrate&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/starlake/docs/next/category/deploy">Deploy</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/starlake/docs/next/category/configuration">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/starlake/docs/next/category/cli">CLI</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/starlake/docs/next/category/developer-guide">Developer Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Declarative Data Pipelines<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/starlake/docs/guides/unit-tests/transform-tests">latest version</a></b> (<!-- -->1.2.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/starlake/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/starlake/docs/next/category/guides"><span itemprop="name">Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/starlake/docs/next/category/unit-tests"><span itemprop="name">Unit Tests</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Test Transform Tasks</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Test Transform Tasks</h1><p>Test your transform locally before deploying to production.</p><p>Transform tasks are the second step in the data pipeline.
They are responsible for transforming the data in the database.
In this tutorial, we will test the transform tasks.</p><p>Transform tests are located in the <code>metadata/tests/transform</code> directory.</p><p>Each test is a directory located in the <code>domain/table</code> subdirectory and contains the following files:</p><ul><li>multiple CSV or JSON files that will contain the initial data that will be loaded into the tables before the unit test is run.
These files should be named after the domain and table names. For example, the file for the <code>starbake.product</code> table should be named <code>starbake.product.json</code> or <code>starbake.product.csv</code>.</li><li>a <code>_expected.csv</code> or <code>_expected.sql</code> file that contains the expected data in the table after the transform task is run.</li></ul><p>Before running the transform, starlake will transpile your SQL statements to the Duckdb dialect before running it.
After running the transpiled SQL staement using the <code>starlake transform</code> task against local duckdb database populated by starlake using the data files present in the test directory,
Starlake will compare the schema of the table with the schema of the expected data file and will raise an error if they do not match.</p><p>The test will pass if the transform task succeeds and the data in the table matches the data in the <code>_expected.csv</code> file.</p><p>The reports of the test <code>test-name</code> are stored in the <code>test-reports/transform/test-name</code> directory and contain the following files:</p><ul><li><code>test-reports/transform/test-name/testname.db</code>: the actual database after the load task is run. This database contains the following tables:<ul><li>sl_expected: The expected data.</li><li><code>starbake.product</code>: The actual data.</li><li>sl_expectations: The results of the execution of any the expectation related to this table.</li><li>audit.audit: The audit log of the transform task.</li></ul></li><li><code>test-reports/transform/test-name/not_expected.csv</code>: the unexpected data in the actual table after the transform task is run.</li><li><code>test-reports/transform/test-name/missing.csv</code>: the missing data in the actual table after the transform task is run.</li></ul><p>The test reports are generated using the <code>starlake test</code> task.</p><p>To run the transform tests without running load tests, use the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">starlake </span><span class="token builtin class-name">test</span><span class="token plain"> --transform</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To run a specific test use the <code>--name</code> flag:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">starlake </span><span class="token builtin class-name">test</span><span class="token plain"> --name starbake.product.test-name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running tests will also generate a complete website report in the <code>test-reports</code> directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-load--summary-report">Example: Load  summary report<a href="#example-load--summary-report" class="hash-link" aria-label="Direct link to Example: Load  summary report" title="Direct link to Example: Load  summary report">​</a></h2><p><img loading="lazy" src="/starlake/assets/images/load-summary-e46b35d6c4082a8664bbb20ceb83ace0.png" width="768" height="377" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-transform-test-report">Example: Transform Test report<a href="#example-transform-test-report" class="hash-link" aria-label="Direct link to Example: Transform Test report" title="Direct link to Example: Transform Test report">​</a></h2><p><img loading="lazy" src="/starlake/assets/images/transform-98e87387c51455f62f0d6a35e1d05cab.png" width="783" height="576" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-load--transform-report">Example: Load &amp; Transform report<a href="#example-load--transform-report" class="hash-link" aria-label="Direct link to Example: Load &amp; Transform report" title="Direct link to Example: Load &amp; Transform report">​</a></h2><p><img loading="lazy" src="/starlake/assets/images/report-f0a008ed2359a2a4af3738eb28b19b53.png" width="768" height="425" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/starlake-ai/starlake/edit/master/docs/docs/0300-guides/0400-unit-tests/200-transform-tests.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/starlake/docs/next/guides/unit-tests/load-tests"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Test Load Tasks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/starlake/docs/next/category/orchestrate"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Orchestrate</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example-load--summary-report" class="table-of-contents__link toc-highlight">Example: Load  summary report</a></li><li><a href="#example-transform-test-report" class="table-of-contents__link toc-highlight">Example: Transform Test report</a></li><li><a href="#example-load--transform-report" class="table-of-contents__link toc-highlight">Example: Load &amp; Transform report</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/starlake/docs/intro">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/starlake/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
<ul class="footer_right"><li><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a></li><li><a href="https://join.slack.com/t/starlakeai/shared_invite/zt-28vf5d49s-rnyuh70OrJjcX_2Vz2mafw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a></li></ul>
</li></ul></div></div></div></footer></div>
<script src="/starlake/assets/js/runtime~main.de1a9ea1.js"></script>
<script src="/starlake/assets/js/main.d3f17b61.js"></script>
</body>
</html>