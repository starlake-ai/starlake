<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">One post tagged with &quot;Polars&quot; | Declarative Data Pipelines</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://starlake-ai.github.io/starlake/blog/tags/polars"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;Polars&quot; | Declarative Data Pipelines"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/starlake/img/favicon_starlake.ico"><link data-rh="true" rel="canonical" href="https://starlake-ai.github.io/starlake/blog/tags/polars"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/blog/tags/polars" hreflang="en"><link data-rh="true" rel="alternate" href="https://starlake-ai.github.io/starlake/blog/tags/polars" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/starlake/blog/rss.xml" title="Declarative Data Pipelines RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/starlake/blog/atom.xml" title="Declarative Data Pipelines Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-207943293-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FYS72XYD48"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FYS72XYD48",{anonymize_ip:!0})</script><link rel="stylesheet" href="/starlake/assets/css/styles.9a292966.css">
<link rel="preload" href="/starlake/assets/js/runtime~main.151498fb.js" as="script">
<link rel="preload" href="/starlake/assets/js/main.d74722bf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/starlake/"><div class="navbar__logo"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--light_HNdA"><img src="/starlake/img/starlake_icon.svg" alt="Starlake" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Starlake</b></a><a class="navbar__item navbar__link" href="/starlake/docs/intro">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/starlake/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/starlake/docs/intro">1.2.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/starlake/docs/next/intro">Next</a></li><li><a class="dropdown__link" href="/starlake/docs/intro">1.2.0</a></li><li><a class="dropdown__link" href="/starlake/docs/1.1.0/intro">1.1.0</a></li><li><a class="dropdown__link" href="/starlake/docs/1.0.0/intro">1.0.0</a></li></ul></div><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a><a href="https://join.slack.com/t/starlakeai/shared_invite/zt-28vf5d49s-rnyuh70OrJjcX_2Vz2mafw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/starlake/blog/polars-vs-spark">Polars versus Spark</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/starlake/blog/starlake-oss">Starlake OSS - Bringing Declarative Programming to Data Engineering and Analytics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/starlake/blog/rls-cls-big-query">Column  and Row Level Security in BigQuery</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/starlake/blog/spark-big-query-partitioning">Handling Dynamic Partitioning and Merge with Spark on BigQuery</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/starlake/blog/bonjour">Bonjour</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;Polars&quot;</h1><a href="/starlake/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Introduction"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/starlake/blog/polars-vs-spark">Polars versus Spark</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-05-28T00:00:00.000Z" itemprop="datePublished">May 28, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/hayssams/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://s.gravatar.com/avatar/04aa2a859a66b52787bcba8c36beba8c.png" alt="Hayssam Saleh" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/hayssams/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Hayssam Saleh</span></a></div><small class="avatar__subtitle" itemprop="description">Starlake Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Polars is often compared to Spark. In this post, I will highlight the main differences and the best use cases for each in my data engineering activities.</p><p>As a Data Engineer, I primarily focus on the following goals:</p><ol><li>Parsing files, validating their input, and loading the data into the target data warehouse.</li><li>Once the data is loaded, applying transformations by joining and aggregating the data to build KPIs.</li></ol><p>However, on a daily basis, I also need to develop on my laptop and test my work locally before delivering it to the CI pipeline and then to production.</p><p>What about my fellow data scientist colleagues? They need to run their workload on production data through their favorite notebook environment.</p><p>This post addresses the following points:</p><ul><li>How suitable each tool is for loading files into your data warehouse.</li><li>How easy and powerful each tool is for performing transformations.</li><li>How easy it is to test your code locally before deploying to the cloud</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-tasks">Load tasks<a href="#load-tasks" class="hash-link" aria-label="Direct link to Load tasks" title="Direct link to Load tasks">​</a></h2><p>Data loading seems easy at first glance, as almost all databases and APIs offer some sort of single-line command to load a few lines or millions of records quickly. However, this simplicity disappears when you encounter real-world cases such as:</p><ul><li>Fixed-width fields: These files are typically exported from mainframe databases.</li><li>XML files: I sometimes work in  the finance industry where SWIFT is a common XML file format that will be around for some time.</li><li>Multi-character CSV: For example, where the separator consists of two characters like ||.</li><li>File validation: You cannot trust the files you receive and need to check their content thoroughly.</li></ul><p>Loading correct CSV or JSON files using Spark or Polars is straightforward. However, it is also straightforward using your favorite database command line utility, making this capabilities somewhat redundant and even slower than the native data warehouse load feature.</p><p>However, in real-world scenarios, you want to ensure the incoming file adheres to the expected schema and load a variety of file formats not supported natively. This is where Spark excels compared to Polars, as it allows for the parallel loading of your JSONL or CSV files and offers through map operations local and distributed validation of your incoming file.</p><p>As XML and multichar and multiline CSV are only supported by Spark, dealing with file parsing for data loading, Spark is definitely the most suitable solution.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transform-tasks">Transform tasks<a href="#transform-tasks" class="hash-link" aria-label="Direct link to Transform tasks" title="Direct link to Transform tasks">​</a></h2><p>Three interfaces are provided to transform data: SQL, Dafarames and Datasets.</p><p><strong>SQL</strong></p><p>SQL is the preferred language for most data analysts when it comes to computing aggregations. One of its key benefits is its widespread understanding, which eliminates the learning curve.</p><p>You can use SQL with both Spark and Polars, but Polars has significant limitations. It does not support SQL Window functions nor does it support the SQL statements for update, insert, delete, or merge operations.</p><p><strong>Dataframes</strong></p><p>Both Polars and Spark offer excellent support for DataFrames. The main added value of using DataFrames is the ability to reuse portions of code and access features not available in standard SQL, such as lambda functions, JSON handling and array manipulation.</p><p><strong>Datasets</strong></p><p>As a software engineer, I particularly appreciate Datasets. Datasets are typed DataFrames, meaning that syntax, column names, and types are checked at compile time. If you believe that statically typed languages greatly enhance code quality, then you understand the added value of datasets.</p><p>Datasets are only supported by Spark, allowing you to write clean, reusable, and statically typed transformations. They are available exclusively to statically typed languages such as Java or Scala.</p><p>Spark stands out as the only tool with complete support for SQL, DataFrames, and Datasets. Polars’ limited support for SQL makes it less suitable for my data engineering tasks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-era">Cloud Era<a href="#cloud-era" class="hash-link" aria-label="Direct link to Cloud Era" title="Direct link to Cloud Era">​</a></h2><p>At least 60% of the projects I have worked on are cloud-based, primarily targeting Amazon Redshift, Google BigQuery, Databricks, Snowflake, or Azure Synapse. All of these platforms offer serverless support for Spark, making it incredibly easy to run workloads by simply providing your PySpark script and letting the cloud provider handle the rest.</p><p>In the cloud environment, Spark is definitely the tool of choice as I see it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="single-node">Single node<a href="#single-node" class="hash-link" aria-label="Direct link to Single node" title="Direct link to Single node">​</a></h2><p>There has been much discussion about Spark being slow or too heavy for single-node computers. I was particularly interested in running this test since I currently execute most of my workloads on a single-node Google Cloud Run job with Spark embedded in my Docker image.</p><p>I decided to conduct this test on my almost 3-year-old MacBook Pro M1 Max with 64GB of memory. The test involved loading 27GB of CSV data, selecting a few attributes, computing metrics on those selected attributes, and then saving the results to a Parquet file.</p><p>I ran Spark with default settings and without any fine-tuning. This means it utilized all 10 cores of my MacBook Pro M1 Max but only 1 gigabyte of memory for execution.</p><p>::: note
I could have optimized my Spark workload, but given the small size of the dataset (27GB of CSV), it didn&#x27;t make sense. The default settings were sufficient.
:::</p><p>Here are the results after a cold restart  of my laptop before each test  to ensure the test did not benefit from any operating system cache.</p><ul><li><p>Apache Spark pipeline took: 29 seconds</p></li><li><p>Polars pipeline took: 56 seconds</p></li></ul><p>::: note
Rerunning Polars gave me 23 seconds instead of 56 seconds. This discrepancy is probably due to filesystem caching by the operating system.
:::</p><p>Load and Save Test: Load a 27GB CSV file with 193 columns per record and save  the result as parquet.</p><ul><li><p>Apache Spark pipeline took: 2mn 18s</p></li><li><p>Polars pipeline took: 2mn 32s</p></li></ul><p>Load parquet and filter on column value then return count : Load a 74 millions records parquet file with 193 columns, filter on &#x27;model&#x27; column and return count.</p><ul><li><p>Apache Spark pipeline took: 3 seconds</p></li><li><p>Polars pipeline took: 28 seconds</p></li></ul><p>The table below summarises the results</p><table><thead><tr><th>Task</th><th>Spark 1GB memory</th><th>Polars All the available memory</th></tr></thead><tbody><tr><td>Load CSV, aggregate and save the aggregation as parquet</td><td>29s</td><td>56s</td></tr><tr><td>Load CSV and Save parquet</td><td>2mn 18s</td><td>2mn 32s</td></tr><tr><td>Load Parquet, filter and count</td><td>3s</td><td>28s</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>I don’t think it is time to switch from Spark to Polars, at least for those of us accustomed to the JVM, running workloads in the cloud, or even working on small datasets. However, Polars may be a perfect fit for those familiar with pandas.</p><p>As of today, Spark is the only framework I see that can handle both local and distributed workloads, adapt to on-premise and cloud serverless jobs, and provide the complete SQL support required for most of our transformations.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/starlake/blog/tags/polars">Polars</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/starlake/blog/tags/spark">Spark</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/starlake/blog/tags/databricks">Databricks</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/starlake/blog/tags/data-engineering">Data Engineering</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/starlake/blog/tags/analytics">Analytics</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/starlake/docs/intro">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/starlake/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
<ul class="footer_right"><li><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a></li><li><a href="https://join.slack.com/t/starlakeai/shared_invite/zt-28vf5d49s-rnyuh70OrJjcX_2Vz2mafw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link header-icon-link" aria-label="Community"></a></li></ul>
</li></ul></div></div></div></footer></div>
<script src="/starlake/assets/js/runtime~main.151498fb.js"></script>
<script src="/starlake/assets/js/main.d74722bf.js"></script>
</body>
</html>